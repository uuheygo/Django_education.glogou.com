{% extends "schools/base.html" %} 
{% load strip_space %}

{% block content %}
<div class="row">
    <h3>Compare Media Indexes of <b><a href="/schools/school_id={{this_school.id}}/{{this_school.name|lower|nospace}}/">{{this_school.name}}</a></b> with Selected Schools</h3>
    <h4>
        {% for school in selected_schools %}
            <<a href="/schools/school_id={{school.id}}/{{school.name|lower|nospace}}/">{{school.name}}</a>>
        {% endfor %}
    </h4>
    <hr>
</div>
<div class="row">
          <div class="dropdown">
            <button id="selected_period" class="btn btn-default dropdown-toggle" type="button" id="chart_period" data-toggle="dropdown">Select Period
            <span class="caret"></span></button>
            <ul class="dropdown-menu" role="menu" aria-labelledby="menu1">
              <li role="presentation"><a role="menuitem" tabindex="-1" onclick="redirectTo(7)">last 7 days</a></li>
              <li role="presentation"><a role="menuitem" tabindex="-1" onclick="redirectTo(30)">last 30 days</a></li>
              <li role="presentation"><a role="menuitem" tabindex="-1" onclick="redirectTo(180)">last 180 days</a></li>
            </ul>
          </div>
</div>
<hr>
<!-- gg -->
<div class="row">
    <div class="panel panel-default">
        <div class="panel-heading"><h4><b>Google Indexes - Last {{num_days}} days</b></h4></div>
        <div class="panel-body">
            <div class="col-sm-6" style="margin-bottom: 10px;"><div id="index_0"></div></div>
            <div class="col-sm-6" style="margin-bottom: 15px;"><div id="index_00"></div></div>
            <hr>
            <div class="col-sm-6" style="margin-bottom: 10px;"><div id="index_1"></div></div>
            <div class="col-sm-6" style="margin-bottom: 15px;"><div id="index_11"></div></div>
            <hr>
            <div class="col-sm-6" style="margin-bottom: 10px;"><div id="index_2"></div></div>
            <div class="col-sm-6" style="margin-bottom: 15px;"><div id="index_22"></div></div>
            <hr>
            <div class="col-sm-6" style="margin-bottom: 10px;"><div id="index_3"></div></div>
            <div class="col-sm-6" style="margin-bottom: 10px;"><div id="index_33"></div></div>
        </div>
    </div>
</div>
<!-- /gg -->

<!-- bd -->
<div class="row">
    <div class="panel panel-default">
        <div class="panel-heading"><h4><b>Baidu Indexes - Last {{num_days}} days</b></h4></div>
        <div class="panel-body">
            <div class="col-sm-6" style="margin-bottom: 10px;"><div id="index_4"></div></div>
            <div class="col-sm-6" style="margin-bottom: 10px;"><div id="index_44"></div></div>
            <hr>
            <div class="col-sm-6" style="margin-bottom: 10px;"><div id="index_5"></div></div>
            <div class="col-sm-6" style="margin-bottom: 10px;"><div id="index_55"></div></div>
            <hr>
            <div class="col-sm-6" style="margin-bottom: 10px;"><div id="index_6"></div></div>
            <div class="col-sm-6" style="margin-bottom: 10px;"><div id="index_66"></div></div>
            <hr>
            <div class="col-sm-6" style="margin-bottom: 10px;"><div id="index_7"></div></div>
            <div class="col-sm-6" style="margin-bottom: 10px;"><div id="index_77"></div></div>
            <hr>
            <div class="col-sm-6" style="margin-bottom: 10px;"><div id="index_8"></div></div>
            <div class="col-sm-6" style="margin-bottom: 10px;"><div id="index_88"></div></div>
        </div>
    </div>
</div>
<!-- /bd -->

<!-- yh -->
<!-- <div class="row"> -->
<!--     <div class="panel panel-default"> -->
<!--         <div class="panel-heading"><h4><b>Yahoo Japan Indexes - Last {{num_days}} days</b></h4></div> -->
<!--         <div class="panel-body"> -->
<!--             <div class="col-sm-6" style="margin-bottom: 10px;"><div id="index_9"></div></div> -->
<!--             <div class="col-sm-6" style="margin-bottom: 10px;"><div id="index_99"></div></div> -->
<!--             <hr> -->
<!--             <div class="col-sm-6" style="margin-bottom: 10px;"><div id="index_10"></div></div> -->
<!--             <div class="col-sm-6" style="margin-bottom: 10px;"><div id="index_1010"></div></div> -->
<!--         </div> -->
<!--     </div> -->
<!-- </div> -->
<!-- /yh -->

{% endblock %}

{% block sidebar %}
<!-- <div class="sidebar" role="navigation" style="margin-top: 20px;"> -->
<!--         <ul class="nav nav-sidebar" style="text-align: center;"> -->
<!--             <li><h4><img src="/static/schools/images/baidu.png"  height="25" style="margin-bottom: 5px;margin-right: 5px;">Baidu</h4></li> -->
<!--             <li ><a  href="#">Search(English Name)</a></li> -->
<!--             <li><a href="#">Search(Chinese Name)</a></li> -->
<!--             <li><a href="#">News(English Name)</a></li> -->
<!--             <li><a href="#">News(Chinese Name)</a></li> -->
<!--             <li><a href="#">University Sites</a></li> -->
<!--         </ul> -->
<!-- </div> -->

<div class="navbar-default sidebar" role="navigation">
    <div class="sidebar-nav navbar-collapse collapse">
        <ul class="nav" id="side-menu">
            <li>
                <a href="#"><span class="glyphicon glyphicon-stats"></span> Composite Index</a>
            </li>
            <!-- baidu -->
            <li>
                <a href="#"><img src="/static/schools/images/baidu.png" width="25" height="25"> Baidu Indexes<span class="glyphicon glyphicon-chevron-left" style="float: right;"></span></a>
                <ul class="nav nav-second-level">
                    <li>
                        <a href="#">Page Index (EN)</a>
                    </li>
                    <li>
                        <a href="#">Page Index (CH)</a>
                    </li>
                    <li>
                        <a href="#">News Index (EN)</a>
                    </li>
                    <li>
                        <a href="#">News Index (CH)</a>
                    </li>
                    <li>
                        <a href="#">Site Index</a>
                    </li>
                </ul>
            </li>
            <!-- google -->
            <li>
                <a href="#"><img src="/static/schools/images/google.png" width="25" height="25"> Google Indexes<span class="glyphicon glyphicon-chevron-left" style="float: right;"></span></a>
                <ul class="nav nav-second-level">
                    <li>
                        <a href="#">Page Index (EN)</a>
                    </li>
                    <li>
                        <a href="#">Page Index (HK)</a>
                    </li>
                    <li>
                        <a href="#">News Index (EN)</a>
                    </li>
                    <li>
                        <a href="#">Site Index</a>
                    </li>
                </ul>
            </li>
        </ul>
    </div>
    <!-- /.sidebar-collapse -->
</div>
{% endblock %}

{% block custom_js %}
<!-- <script type="text/javascript">
    $(function() {
        $("#page-wrapper").css('margin-left', '0px');
    })
</script> -->

<script type="text/javascript">
    google.load('visualization', '1', {packages: ['corechart', 'line']});
    google.setOnLoadCallback(drawCharts);
    
    function drawCharts() {
      var data = []; // 11 in total corresponding to different indexes
      var data_col = [] // data for column chart
      var index_name = ["gg index en", "gg index hk", "gg news","gg site", 
            "bd index ch", "bd index en", "bd news ch", "bd news en", "bd site", "yh index en", "yh index jp"];
      
      //-----------------------line chart--------------------------
      for(var i = 0; i < 11; i++) {
          data[i] = new google.visualization.DataTable();
          data[i].addColumn('date', 'month');
          
          {% for name in name_list %}
            data[i].addColumn('number', '{{name}}');
          {% endfor %}
      }
      
      {% for list in index_list %}
      data[{{forloop.counter0}}].addRows([
          {% for row in list reversed %}
          [new Date("{{row.0.date}}"), 
            {% for entry in row %}
                {{entry.index}},
            {% endfor %}
          ],
          {% endfor %}
      ])
      
      
      var options = {
        title: index_name[{{forloop.counter0}}],
        titleTextStyle: {fontSize: 15},
        legend: {position: 'top', maxLines: 3},
        //curveType: 'function',
        hAxis: {
          title: 'Date',
          format:'M/d/y',
          titleTextStyle: {fontSize: 15},
        },
        vAxis: {
          title: 'Index',
          titleTextStyle: {fontSize: 15},
        },
        backgroundColor: '#f1f8e9',
        //height: 200,
        width: '100%',
        pointSize: 7,
        };

      var chart{{forloop.counter0}} = new google.visualization.LineChart(document.getElementById('index_{{forloop.counter0}}'));
      chart{{forloop.counter0}}.draw(data[{{forloop.counter0}}], options);
      {% endfor %}
      
      //-----------------------column chart--------------------------
      google.load("visualization", "1.1", {packages:["corechart"]});
      
      var data_set_col = [];
      
      {% for data_set in data_sets_col %} // column chart data import
      data_col[{{forloop.counter0}}] = google.visualization.arrayToDataTable({{data_set|safe}});
      {% endfor %}
      
      console.log(data_col);
      var options_col = {
                title: 'Latest Index ({{latest_date}})',
                height: 200,
                legend: {position: 'none'},
                backgroundColor: '#f1f8e9',
                //chartArea: {top:40, left: 60, 'width': '90%', 'height': '75%'},
                //bars: 'horizontal',
                hAxis: {
                        //title: 'School',
                        titleTextStyle: {
                            fontSize: 15,
                            //color: '#053061',
                            //bold: true,
                            //italic: false
                          }
                    },
                vAxis: {
                        title: 'Search Index',
                        titleTextStyle: {
                            fontSize: 15,
                            //color: '#053061',
                            //bold: true,
                            //italic: false
                          }
                    },
            };
      
      var chart_col = [];
      // draw column chart
      for(var i = 0; i < data_col.length; i++) {
        chart_col[i] = new google.visualization.ColumnChart(document.getElementById('index_' + i + i));
        chart_col[i].draw(data_col[i], options_col);
      }
      
    };
    
    $(window).resize(function(){
        drawCharts();
    });
    
    function redirectTo(num_days) {
        currURL = document.URL;
        window.location = currURL.split("&num_days")[0] + "&num_days=" + num_days;
    }
</script>
{% endblock %}